# legion go 2 z2e nixos setup

## status: PHASE 1 COMPLETE ✓

thread: https://ampcode.com/threads/T-019b5fa3-5e49-7798-8fd4-a67e0d2bda12

## what we've done

### flake changes
- added `jovian-nixos` input to flake.nix
- updated nixpkgs, stylix, home-manager, nixvim to latest (dec 2025)
- fixed several breaking changes:
  - `vaapiVdpau` → `libva-vdpau-driver`
  - `amdvlk` removed (RADV is default now)
  - vicinae theme conflicts with stylix
  - greetd conflicts when jovian autostart enabled
  - dconf cursor-size conflicts

### host configuration created
- `hosts/lgo-z2e/default.nix` - full gaming handheld config
- `hosts/lgo-z2e/hardware.nix` - placeholder (needs real UUIDs after install)

features enabled:
- jovian.steam.enable + autoStart (gaming mode boot)
- jovian.steam.desktopSession = "niri"
- jovian.decky-loader.enable
- services.handheld-daemon (hhd for controller/gyro/TDP)
- stylix theming with larger fonts/cursor for handheld
- syncthing mesh with r56/mbp-m2/htz-relay

### ISO installer created
- `iso/lgo-z2e-installer.nix` - bootable installer with:
  - jovian + hhd pre-installed
  - nixos user with password "nixos"
  - ssh enabled
  - latest kernel with amd_pstate

## to build ISO

```bash
# from x86_64-linux machine (r56)
cd ~/commonplace/01_files/nix
nix build .#nixosConfigurations.lgo-z2e-installer.config.system.build.isoImage -o ~/commonplace/02_temp/lgo-z2e-iso

# result will be in ~/commonplace/02_temp/lgo-z2e-iso/iso/
# ⚠️  DO NOT build to default ./result - it will sync via syncthing and clog devices
```

## next steps (phase 2)

1. **build ISO** on r56 or another x86_64-linux machine
2. **flash to USB/SD** using `dd` or similar
3. **boot legion go 2** from USB
4. **partition disk**:
   ```bash
   sudo parted /dev/nvme0n1 -- mklabel gpt
   sudo parted /dev/nvme0n1 -- mkpart ESP fat32 1MB 512MB
   sudo parted /dev/nvme0n1 -- set 1 esp on
   sudo parted /dev/nvme0n1 -- mkpart primary ext4 512MB 100%
   sudo mkfs.fat -F 32 -n BOOT /dev/nvme0n1p1
   sudo mkfs.ext4 -L nixos /dev/nvme0n1p2
   ```
5. **mount and install**:
   ```bash
   sudo mount /dev/disk/by-label/nixos /mnt
   sudo mkdir -p /mnt/boot
   sudo mount /dev/disk/by-label/BOOT /mnt/boot
   sudo nixos-generate-config --root /mnt
   # copy hardware-configuration.nix UUIDs to hosts/lgo-z2e/hardware.nix
   sudo nixos-install --flake github:bdsqqq/dots#lgo-z2e
   ```
6. **reboot** into installed system

## hardware specs (from research)
- **cpu**: amd ryzen z2 extreme (3x zen 5 + 5x zen 5c cores, 8c/16t, up to 5ghz)
- **gpu**: rdna 3.5 integrated, 16 CUs
- **ram**: 32gb (shared with igpu)
- **display**: 8.8" OLED, 2560x1600 (2K), 144hz, VRR 48-120hz
- **storage**: 1tb m.2 2242 ssd (upgradeable to 2280)
- **battery**: 74 whr
- **controllers**: detachable TrueStrike controllers with gyro

## linux compatibility (dec 2025)
- **official steamos support** announced for legion go 2
- **hhd** lists "Go 2" as supported
- **kernel drivers**: lenovo-wmi-gamezone has patches for extreme mode
- **known issues**: gyro drift (calibrate via hhd), factory reset controllers if legion space mappings interfere

## open questions for phase 2
- [ ] actual hardware UUIDs after partitioning
- [ ] display scaling tuning for 2K on 8.8"
- [ ] TDP controls - test if hhd works out of box
- [ ] gyro calibration
- [ ] battery life optimization

## references
- https://github.com/Jovian-Experiments/Jovian-NixOS
- https://github.com/hhd-dev/hhd
- https://jovian-experiments.github.io/Jovian-NixOS/configuration.html
