# rustdesk setup - PENDING REBUILDS

## status: sops password injection implemented, awaiting rebuilds

## what was done
1. created `system/rustdesk.nix` with platform-conditional logic
2. r56: adds `pkgs.rustdesk` + opens port 21118 on tailscale0
3. mbp-m2: adds homebrew cask `rustdesk` (v1.4.4)
4. both host configs updated with import

## rebuild commands

### r56 (run in this directory)
```bash
sudo nixos-rebuild switch --flake .#r56
```

### mbp-m2 (run on mbp-m2)
```bash
darwin-rebuild switch --flake ~/commonplace/01_files/nix#mbp-m2
```

## verified
- [x] r56 port 21118 listening
- [x] mbp-m2 port 21118 listening
- [x] cross-host connectivity (nc -zv 100.87.59.2 21118 from r56)
- [x] declarative config merge via home.activation

## remaining: run rebuilds to inject sops password

password now auto-injected from sops `rustdesk_password` secret (commit dab7ebb).

**r56:**
```bash
sudo nixos-rebuild switch --flake .#r56
```

**mbp-m2:**
```bash
cd ~/commonplace/01_files/nix && git pull
sudo darwin-rebuild switch --flake .#mbp-m2
```

after rebuild, verify password injected:
```bash
# r56
grep permanent-password ~/.config/rustdesk/RustDesk2.toml

# mbp-m2
grep permanent-password ~/Library/Preferences/com.carriez.RustDesk/RustDesk2.toml
```

## connecting

enter the OTHER machine's tailscale IP in "control remote desktop" field:
- **r56**: 100.94.68.111
- **mbp-m2**: 100.87.59.2

the "unencrypted" warning is misleading â€” tailscale provides end-to-end wireguard encryption.

## sources
- https://tailscale.com/kb/1599/rustdesk (official guide)
- https://tailscale.com/blog/tailscale-rustdesk-remote-desktop-access
