# Justfile for Quickshell QML development
# Install just: nix-shell -p just

# Default recipe - show available commands
default:
    @just --list

# Enter nix shell with QML tooling
shell:
    nix-shell shell.nix

# Lint all QML files (expects shell.nix env: wrappers + import paths)
lint:
    #!/usr/bin/env bash
    find . -name "*.qml" -type f | head -20 | while read f; do
      echo "Linting: $f"
      qmllint "$f" || true
    done

# Lint specific file
lint-file file:
    qmllint {{file}}

# Watch for changes and lint continuously (requires: nix-shell -p entr)
watch:
    #!/usr/bin/env bash
    echo "Watching .qml files for changes... (Ctrl+C to stop)"
    find . -name "*.qml" | entr -c just lint

# Watch specific file
watch-file file:
    #!/usr/bin/env bash
    echo "Watching {{file}} for changes... (Ctrl+C to stop)"
    echo "{{file}}" | entr -c qmllint {{file}}

# Format all QML files (in-place)
format:
    find . -name "*.qml" -type f -exec qmlformat -i {} \;

# Format specific file (in-place)
format-file file:
    qmlformat -i {{file}}

# Check formatting without modifying
check-format:
    find . -name "*.qml" -type f -exec qmlformat --check {} \;

# Start LSP server for editor integration
lsp:
    echo "Starting qmlls..."
    echo "Configure your editor to connect to this LSP server"
    qmlls -E

# Validate shell.qml specifically (main entry point)
check:
    qmllint shell.qml

# Restart quickshell service (after config changes)
restart:
    systemctl --user restart quickshell

# Check quickshell status
status:
    systemctl --user status quickshell --no-pager

# View quickshell logs
logs:
    journalctl --user -u quickshell -f

# Test IPC commands
test-ipc:
    quickshell ipc bar toggle
