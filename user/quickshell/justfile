# Justfile for Quickshell QML development
# Install just: nix-shell -p just

# Default recipe - show available commands
default:
    @just --list

# Enter nix shell with QML tooling
shell:
    nix-shell shell.nix

# Lint all QML files
lint:
    #!/usr/bin/env bash
    export QML_IMPORT_PATH=$(nix-build '<nixpkgs>' -A quickshell)/lib/qt-6/qml:$(nix-build '<nixpkgs>' -A qt6.qtdeclarative)/lib/qt-6/qml
    find . -name "*.qml" -type f | head -20 | while read f; do
      echo "Linting: $f"
      qmllint "$f" || true
    done

# Lint specific file
lint-file file:
    #!/usr/bin/env bash
    export QML_IMPORT_PATH=$(nix-build '<nixpkgs>' -A quickshell)/lib/qt-6/qml:$(nix-build '<nixpkgs>' -A qt6.qtdeclarative)/lib/qt-6/qml
    qmllint {{file}}

# Format all QML files (in-place)
format:
    find . -name "*.qml" -type f -exec qmlformat -i {} \;

# Format specific file (in-place)
format-file file:
    qmlformat -i {{file}}

# Check formatting without modifying
check-format:
    find . -name "*.qml" -type f -exec qmlformat --check {} \;

# Start LSP server for editor integration
lsp:
    #!/usr/bin/env bash
    export QMLLS_BUILD_DIRS=$(nix-build '<nixpkgs>' -A quickshell)/lib/qt-6/qml:$(nix-build '<nixpkgs>' -A qt6.qtdeclarative)/lib/qt-6/qml
    echo "Starting qmlls..."
    echo "Configure your editor to connect to this LSP server"
    qmlls -E

# Validate shell.qml specifically (main entry point)
check:
    #!/usr/bin/env bash
    export QML_IMPORT_PATH=$(nix-build '<nixpkgs>' -A quickshell)/lib/qt-6/qml:$(nix-build '<nixpkgs>' -A qt6.qtdeclarative)/lib/qt-6/qml
    qmllint shell.qml

# Restart quickshell service (after config changes)
restart:
    systemctl --user restart quickshell

# Check quickshell status
status:
    systemctl --user status quickshell --no-pager

# View quickshell logs
logs:
    journalctl --user -u quickshell -f

# Test IPC commands
test-ipc:
    quickshell ipc bar toggle
